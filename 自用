local old
old = hookmetamethod(game:GetService("StarterGui"), "__namecall", newcclosure(function(self, ...)
        local method = getnamecallmethod()
        local args = {...}
        if method == "SetCore" and args[1] == "SendNotification" then
            local options = args[2]
            if type(options) == "table" and 
               tostring(options.Title) == "人挤人脚本" and 
               tostring(options.Text) == "kismile制作" 
            then
                local modifiedOptions = table.clone(options)
                modifiedOptions.Text = "1"
            end
        end
     return old(self, ...)
end))


local main = require(game:GetService("ReplicatedStorage").Util.CameraShaker.Main)
local returnnil = function() return nil end

main.StartShake = returnnil
main.ShakeOnce = returnnil
main.ShakeSustain = returnnil
main.CameraShakeInstance = returnnil
main.Shake = returnnil
main.Start = returnnil


game:GetService("StarterGui"):SetCore("SendNotification",{
	Title = "人挤人脚本",
	Text = "kismile制作",
	Duration = 5;
})
wait(0.1)
local Players = game:GetService("Players")  
local workspace = game:GetService("Workspace")  
local Player = Players.LocalPlayer  
local ui = loadstring(game:HttpGet("https://raw.githubusercontent.com/kismile36/xing/refs/heads/main/rjr/ui.lua"))()
local win = ui:new("人挤人中心")
local UITab1 = win:Tab("公告",'7734068321')
local UITab2 = win:Tab("超级无敌脚本",'7734068321')
local UITab3 = win:Tab("大佛功能区",'7734068321')
local UITab4 = win:Tab("透视",'7734068321')

local about = UITab1:section("公告",true)

about:Label("kismile制作")

about:Label("脚本测试中")

local about = UITab2:section("超级无敌脚本",true)

-- 视野功能

about:Slider("视角缩放距离", "Slider",  128, 128, 10000, false, function(Value)
    game:GetService("Players").LocalPlayer.CameraMaxZoomDistance = Value
end)
-- 自动v4

local toggleKey = "自动v4"
local autoV4Task = nil
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function getToggleState(key)
    if not _G.ToggleStates then _G.ToggleStates = {} end
    return _G.ToggleStates[key] or false
end

local function callAwakeningRemote()
    local Backpack = LocalPlayer:FindFirstChild("Backpack")
    if not Backpack then return end
    
    local Awakening = Backpack:FindFirstChild("Awakening")
    if not Awakening then return end
    
    local RemoteFunc = Awakening:FindFirstChild("RemoteFunction")
    if not RemoteFunc or not RemoteFunc:IsA("RemoteFunction") then return end
    
    local success, err = pcall(function()
        RemoteFunc:InvokeServer(true)
    end)
    if not success then
        warn("自动v4调用失败：", err)
    end
end

local function toggleAutoV4(enable)
    if autoV4Task then
        task.cancel(autoV4Task)
        autoV4Task = nil
    end
    
    if enable then
        autoV4Task = task.spawn(function()
            while getToggleState(toggleKey) do
                callAwakeningRemote()
                task.wait(1) 
            end
            autoV4Task = nil
        end)
    end
end

about:Toggle(toggleKey, "Toggle", false, function(IsEnabled)
    if not _G.ToggleStates then _G.ToggleStates = {} end
    _G.ToggleStates[toggleKey] = IsEnabled
    
    toggleAutoV4(IsEnabled)
end)

-- 缝合

about:Button("飞行",function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/kismile236/rjrym/refs/heads/main/fly.lua"))()
end)

about:Button("法天象地",function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/kismile36/rjrzhongxing/refs/heads/main/rjr/fatianxiangdi"))()
end)

about:Button("皮脚本",function()
	getgenv().XiaoPi="皮脚本QQ群1002100032" loadstring(game:HttpGet("https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua"))()
end)

about:Button("hoho",function()
	loadstring(game:HttpGet('https://raw.githubusercontent.com/acsu123/HOHO_H/main/Loading_UI'))()
end)

-- 大佛功能区

local attackTab = UITab3:section("大佛功能区",true)
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local _ENV = (getgenv or getrenv or getfenv)()
local Settings = {AutoClick = true, ClickDelay = 0.1}
local Module = {}
local _G = _G or getfenv(0)._G
_G.FastAttack = _G.FastAttack ~= nil and _G.FastAttack or true

local function SafeWaitForChild(parent, childName)
	local success, result = pcall(function() return parent:WaitForChild(childName, 10) end)
	if not success or not result then warn("未找到组件: " .. childName) end
	return result
end

local function CheckAndGetCoreComponents()
	local Remotes, Modules, Net, RegisterAttack, RegisterHit, Enemies = nil, nil, nil, nil, nil, nil
	while true do
		Remotes = SafeWaitForChild(ReplicatedStorage, "Remotes")
		Modules = SafeWaitForChild(ReplicatedStorage, "Modules")
		Net = Modules and SafeWaitForChild(Modules, "Net") or nil
		RegisterAttack = Net and SafeWaitForChild(Net, "RE/RegisterAttack") or nil
		RegisterHit = Net and SafeWaitForChild(Net, "RE/RegisterHit") or nil
		Enemies = SafeWaitForChild(workspace, "Enemies")
		if Remotes and Modules and Net and RegisterAttack and RegisterHit and Enemies then
			return Remotes, Net, RegisterAttack, RegisterHit, Enemies
		end
		warn("核心组件缺失，持续重试中...")
		task.wait(1)
	end
end

local function IsAlive(character)
	if not character then return false end
	local humanoid = character:FindFirstChildOfClass("Humanoid")
	return humanoid and humanoid.Health and humanoid.Health > 0
end

local function GetRandomValidPart(target)
	local allParts = target:GetDescendants()
	local validParts = {}
	local humanoidRootPart = target:FindFirstChild("HumanoidRootPart")
	local boneParts = humanoidRootPart and humanoidRootPart.Parent:GetDescendants() or {}
	for _, part in ipairs(allParts) do
		if part:IsA("BasePart") and part.CanCollide and table.find(boneParts, part) then
			table.insert(validParts, part)
		end
	end
	return #validParts > 0 and validParts[math.random(1, #validParts)] or target:FindFirstChild("HumanoidRootPart")
end

Module.FastAttack = (function()
	if _ENV.rz_FastAttack then return _ENV.rz_FastAttack end
	local FastAttack = {
		Distance = 2500,
		attackMobs = true,
		attackPlayers = true,
		Equipped = nil,
		IsRunning = _G.FastAttack,
		consecutiveFailures = 0,
		maxConsecutiveFailures = 5
	}

	local function ProcessEnemies(OthersEnemies, Folder)
		if not Folder or not FastAttack.attackMobs then return nil end
		local BasePart = nil
		for _, Enemy in Folder:GetChildren() do
			if Enemy == Player.Character or not IsAlive(Enemy) then continue end
			local foundPart = GetRandomValidPart(Enemy)
			if foundPart and Player:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
				table.insert(OthersEnemies, {Enemy, foundPart})
				BasePart = foundPart
			end
		end
		return BasePart
	end

	local function ProcessRealPlayers(OthersEnemies)
		if not FastAttack.attackPlayers then return nil end
		local BasePart = nil
		for _, OtherPlayer in Players:GetPlayers() do
			if OtherPlayer == Player then continue end
			local OtherChar = OtherPlayer.Character
			if not IsAlive(OtherChar) then continue end
			local foundPart = GetRandomValidPart(OtherChar)
			if foundPart and Player:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
				table.insert(OthersEnemies, {OtherChar, foundPart})
				BasePart = foundPart
			end
		end
		return BasePart
	end

	function FastAttack:Attack(BasePart, OthersEnemies)
		local _, Net, temp_RegisterAttack, temp_RegisterHit, _ = CheckAndGetCoreComponents()
		if not (BasePart and OthersEnemies and #OthersEnemies > 0 and temp_RegisterAttack and temp_RegisterHit) then
			self.consecutiveFailures = self.consecutiveFailures + 1
			if self.consecutiveFailures >= self.maxConsecutiveFailures then
				self.consecutiveFailures = 0
				self.Equipped = Player.Character and IsAlive(Player.Character) and Player.Character:FindFirstChildOfClass("Tool")
			end
			task.delay(0.5, function() self:AttackNearest() end)
			return
		end
		self.consecutiveFailures = 0
		temp_RegisterAttack:FireServer(Settings.ClickDelay or 0)
		temp_RegisterHit:FireServer(BasePart, OthersEnemies)
	end

	function FastAttack:AttackNearest()
		if not self.IsRunning then return end
		local _, _, _, _, Enemies = CheckAndGetCoreComponents()
		local OthersEnemies = {}
		local Part1 = ProcessEnemies(OthersEnemies, Enemies)
		local Part2 = ProcessRealPlayers(OthersEnemies)
		if #OthersEnemies > 0 then
			self:Attack(Part1 or Part2, OthersEnemies)
		else
			task.wait(0)
		end
	end

	function FastAttack:BladeHits()
		if not self.IsRunning then return end
		local Equipped = Player.Character and IsAlive(Player.Character) and Player.Character:FindFirstChildOfClass("Tool")
		if Equipped and Equipped.ToolTip ~= "Gun" then
			self:AttackNearest()
		else
			task.wait(0)
		end
	end

	task.spawn(function()
		while true do
			task.wait(Settings.ClickDelay)
			if Settings.AutoClick and FastAttack.IsRunning then
				FastAttack:BladeHits()
			else
				task.wait()
			end
		end
	end)

	_ENV.rz_FastAttack = FastAttack
	return FastAttack
end)()

-- UI控件绑定
attackTab:Toggle("开关", "FastAttackToggle", _G.FastAttack, function(state)
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.IsRunning = state
		_G.FastAttack = state
	end
end)

attackTab:Textbox("范围", "AttackRange", "2500", function(text)
	local num = tonumber(text) or 2500
	num = math.floor(math.clamp(num, 1, 2500))
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.Distance = num
	end
end)

attackTab:Textbox("攻速", "ClickDelay", "0.1", function(text)
	local num = tonumber(text) or 0.1
	num = math.round(math.clamp(num, 0.05, 2) * 100) / 100
	Settings.ClickDelay = num
end)

attackTab:Toggle("打怪物", "AttackMobsToggle", true, function(state)
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.attackMobs = state
	end
end)

attackTab:Toggle("打玩家", "AttackPlayersToggle", true, function(state)
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.attackPlayers = state
	end
end)

-- 组件恢复逻辑
task.spawn(function()
	while true do
		task.wait(1)
		if not _ENV.rz_FastAttack then
			warn("⚠️ 快速攻击组件未完全加载，持续尝试恢复...")
			while not _ENV.rz_FastAttack do
				task.wait(0.5)
				if _G.FastAttack then
					local Remotes, Net, RegisterAttack, RegisterHit, Enemies = CheckAndGetCoreComponents()
					Module.FastAttack = Module.FastAttack or (function()
						local FastAttack = {
							Distance=2500,
							attackMobs=true,
							attackPlayers=true,
							Equipped=nil,
							IsRunning=_G.FastAttack,
							consecutiveFailures=0,
							maxConsecutiveFailures=5
						}

						local function ProcessEnemies(OthersEnemies, Folder)
							if not Folder or not FastAttack.attackMobs then return nil end
							local BasePart = nil
							for _, Enemy in Folder:GetChildren() do
								if Enemy == Player.Character or not IsAlive(Enemy) then continue end
								local foundPart = GetRandomValidPart(Enemy)
								if foundPart and Player:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
									table.insert(OthersEnemies, {Enemy, foundPart})
									BasePart = foundPart
								end
							end
							return BasePart
						end

						local function ProcessRealPlayers(OthersEnemies)
							if not FastAttack.attackPlayers then return nil end
							local BasePart = nil
							for _, OtherPlayer in Players:GetPlayers() do
								if OtherPlayer == Player then continue end
								local OtherChar = OtherPlayer.Character
								if not IsAlive(OtherChar) then continue end
								local foundPart = GetRandomValidPart(OtherChar)
								if foundPart and Player:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
									table.insert(OthersEnemies, {OtherChar, foundPart})
									BasePart = foundPart
								end
							end
							return BasePart
						end

						function FastAttack:Attack(BasePart, OthersEnemies)
							local _, Net, temp_RegisterAttack, temp_RegisterHit, _ = CheckAndGetCoreComponents()
							if not (BasePart and OthersEnemies and #OthersEnemies > 0 and temp_RegisterAttack and temp_RegisterHit) then
								self.consecutiveFailures = self.consecutiveFailures + 1
								if self.consecutiveFailures >= self.maxConsecutiveFailures then
									self.consecutiveFailures = 0
									self.Equipped = Player.Character and IsAlive(Player.Character) and Player.Character:FindFirstChildOfClass("Tool")
								end
								task.delay(0.5, function() self:AttackNearest() end)
								return
							end
							self.consecutiveFailures = 0
							temp_RegisterAttack:FireServer(Settings.ClickDelay or 0)
							temp_RegisterHit:FireServer(BasePart, OthersEnemies)
						end

						function FastAttack:AttackNearest()
							if not self.IsRunning then return end
							local _, _, _, _, Enemies = CheckAndGetCoreComponents()
							local OthersEnemies = {}
							local Part1 = ProcessEnemies(OthersEnemies, Enemies)
							local Part2 = ProcessRealPlayers(OthersEnemies)
							if #OthersEnemies > 0 then
								self:Attack(Part1 or Part2, OthersEnemies)
							end
						end

						function FastAttack:BladeHits()
							local Equipped = Player.Character and IsAlive(Player.Character) and Player.Character:FindFirstChildOfClass("Tool")
							if Equipped and Equipped.ToolTip ~= "Gun" then
								self:AttackNearest()
							end
						end

						task.spawn(function()
							while true do
								task.wait(Settings.ClickDelay)
								if Settings.AutoClick and FastAttack.IsRunning then
									FastAttack:BladeHits()
								else
									task.wait(0.1)
								end
							end
						end)

						_ENV.rz_FastAttack = FastAttack
						return FastAttack
					end)()
				end
			end
		end
	end
end)


-- 移速功能

attackTab:Textbox("速度(推荐900）", "TranslateAccelSpeed", "输入速度值", function(Value)
    local speed = tonumber(Value)
    if speed then
        getfenv().translateSpeed = speed
    end
end)

attackTab:Toggle("加速开关", "TranslateAccelToggle", false, function(State)
    getfenv().translateAccelEnabled = State
    
    if State then
        if getfenv().sudu then
            getfenv().sudu:Disconnect()
            getfenv().sudu = nil
        end
        
        getfenv().translateConnection = game:GetService("RunService").Heartbeat:Connect(function()
            if game:GetService("Players").LocalPlayer.Character and 
               game:GetService("Players").LocalPlayer.Character.Humanoid and 
               game:GetService("Players").LocalPlayer.Character.Humanoid.Parent then
               
                local humanoid = game:GetService("Players").LocalPlayer.Character.Humanoid
                
                if humanoid.MoveDirection.Magnitude > 0 then
                    local moveDirection = humanoid.MoveDirection
                    local acceleration = moveDirection * (getfenv().translateSpeed or 50) / 30
                    
                    game:GetService("Players").LocalPlayer.Character:TranslateBy(acceleration)
                end
            end
        end)
    else
        if getfenv().translateConnection then
            getfenv().translateConnection:Disconnect()
            getfenv().translateConnection = nil
        end
    end
end)

-- 透视功能
local about = UITab4:section("透视",true)


about:Toggle("显示", "ESP_PlayerDisplay", false, function(Value)
    if Value then
        local success, err = pcall(function()
            local Players = game:GetService("Players")
            local RunService = game:GetService("RunService")

            local ESP_Enabled = true
            local ShowDistance = true

            local ESP_Objects = {}
            local Connections = {}

            local function CreateNameTag(player, character)
                if not character then return nil end
                
                local head = character:FindFirstChild("Head")
                if not head then return nil end
                
                -- 核心修改：缩小BillboardGui尺寸（从200x50改为120x30）
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "ESP_NameTag_" .. player.UserId
                billboard.Size = UDim2.new(0, 120, 0, 30)  -- 原尺寸：UDim2.new(0, 200, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 3, 0)  -- 位置可根据需要微调，比如改为2.5
                billboard.AlwaysOnTop = true
                billboard.Adornee = head
                
                local frame = Instance.new("Frame")
                frame.Size = UDim2.new(1, 0, 1, 0)
                frame.BackgroundTransparency = 0.7
                frame.BackgroundColor3 = Color3.new(0, 0, 0)
                frame.BorderSizePixel = 0
                frame.Parent = billboard
                
                local nameLabel = Instance.new("TextLabel")
                nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
                nameLabel.BackgroundTransparency = 1
                nameLabel.Text = player.Name
                nameLabel.TextColor3 = Color3.new(1, 1, 1)
                nameLabel.TextScaled = true
                nameLabel.Font = Enum.Font.GothamBold
                nameLabel.TextStrokeTransparency = 0
                nameLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
                -- 限制文字最大尺寸，避免缩放过大
                nameLabel.TextSize = 14  -- 文字大小
                nameLabel.Parent = frame
                
                local distanceLabel = Instance.new("TextLabel")
                distanceLabel.Size = UDim2.new(1, 0, 0.5, 0)
                distanceLabel.Position = UDim2.new(0, 0, 0.5, 0)
                distanceLabel.BackgroundTransparency = 1
                distanceLabel.TextColor3 = Color3.new(1, 1, 0)
                distanceLabel.TextScaled = true
                distanceLabel.Font = Enum.Font.Gotham
                distanceLabel.TextStrokeTransparency = 0
                distanceLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
                -- 距离文字大小
                distanceLabel.TextSize = 12  -- 文字大小
                distanceLabel.Parent = frame
                
                local localPlayer = Players.LocalPlayer
                if localPlayer.Team and player.Team then
                    if localPlayer.Team == player.Team then
                        nameLabel.TextColor3 = Color3.new(0, 1, 0)
                    else
                        nameLabel.TextColor3 = Color3.new(1, 0, 0)
                    end
                end
                
                billboard.Parent = head
                
                return {
                    billboard = billboard,
                    nameLabel = nameLabel,
                    distanceLabel = distanceLabel,
                    character = character
                }
            end

            local function ClearPlayerESP(player)
                if ESP_Objects[player] then
                    if ESP_Objects[player].billboard and ESP_Objects[player].billboard.Parent then
                        ESP_Objects[player].billboard:Destroy()
                    end
                    ESP_Objects[player] = nil
                end
            end

            local function UpdateESP()
                if not ESP_Enabled then return end
                
                local localPlayer = Players.LocalPlayer
                local localCharacter = localPlayer.Character
                if not localCharacter then return end
                
                local localHead = localCharacter:FindFirstChild("Head")
                if not localHead then return end
                
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= localPlayer then
                        local character = player.Character
                        
                        if character and character:FindFirstChild("Humanoid") then
                            local humanoid = character:FindFirstChildOfClass("Humanoid")
                            local head = character:FindFirstChild("Head")
                            
                            if humanoid and head and humanoid.Health > 0 then
                                local distance = (localHead.Position - head.Position).Magnitude
                                
                                if not ESP_Objects[player] then
                                    ESP_Objects[player] = CreateNameTag(player, character)
                                end
                                
                                if ESP_Objects[player] then
                                    if ShowDistance then
                                        ESP_Objects[player].distanceLabel.Text = string.format("%d", math.floor(distance))
                                        ESP_Objects[player].distanceLabel.Visible = true
                                    else
                                        ESP_Objects[player].distanceLabel.Visible = false
                                    end
                                    
                                    ESP_Objects[player].billboard.Enabled = true
                                end
                            else
                                ClearPlayerESP(player)
                            end
                        else
                            ClearPlayerESP(player)
                        end
                    end
                end
            end

            local function SetupPlayerListeners()
                Connections.playerAdded = Players.PlayerAdded:Connect(function(player)
                    Connections["characterAdded_" .. player.UserId] = player.CharacterAdded:Connect(function(character)
                        wait(0.5)
                        UpdateESP()
                    end)
                end)
                
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= Players.LocalPlayer then
                        Connections["characterAdded_" .. player.UserId] = player.CharacterAdded:Connect(function(character)
                            wait(0.5)
                            UpdateESP()
                        end)
                    end
                end
            end

            Connections.playerRemoving = Players.PlayerRemoving:Connect(function(player)
                ClearPlayerESP(player)
                if Connections["characterAdded_" .. player.UserId] then
                    Connections["characterAdded_" .. player.UserId]:Disconnect()
                end
            end)

            Connections.localCharacterAdded = Players.LocalPlayer.CharacterAdded:Connect(function()
                wait(1)
                for player in pairs(ESP_Objects) do
                    ClearPlayerESP(player)
                end
                UpdateESP()
            end)

            Connections.heartbeat = RunService.Heartbeat:Connect(function()
                if ESP_Enabled then
                    UpdateESP()
                end
            end)

            SetupPlayerListeners()
            UpdateESP()

            local ESPControl = {
                toggle = function()
                    ESP_Enabled = not ESP_Enabled
                end,
                
                toggleDistance = function()
                    ShowDistance = not ShowDistance
                end,
                
                clearAll = function()
                    for player in pairs(ESP_Objects) do
                        ClearPlayerESP(player)
                    end
                    ESP_Objects = {}
                end
            }

            _G.ESP = ESPControl

            local function Cleanup()
                for _, connection in pairs(Connections) do
                    if connection then
                        connection:Disconnect()
                    end
                end
                
                for player in pairs(ESP_Objects) do
                    ClearPlayerESP(player)
                end
                
                ESP_Objects = {}
                Connections = {}
                
                _G.ESP = nil
            end

            if _G.__ESP_CLEANUP then
                _G.__ESP_CLEANUP()
            end

            _G.__ESP_CLEANUP = Cleanup
        end)
    else
        local success, err = pcall(function()
            if _G.__ESP_CLEANUP then
                _G.__ESP_CLEANUP()
            end
        end)
    end
end)


local old
old = hookmetamethod(game:GetService("StarterGui"), "__namecall", newcclosure(function(self, ...)
        local method = getnamecallmethod()
        local args = {...}
        if method == "SetCore" and args[1] == "SendNotification" then
            local options = args[2]
            if type(options) == "table" and 
               tostring(options.Title) == "人挤人脚本" and 
               tostring(options.Text) == "kismile制作" 
            then
                local modifiedOptions = table.clone(options)
                modifiedOptions.Text = "1"
            end
        end
     return old(self, ...)
end))

game:GetService("StarterGui"):SetCore("SendNotification",{
	Title = "人挤人脚本",
	Text = "加载完成 祝您使用愉快",
	Duration = 5;
})
